from app.schemas.report import ReportSummary

class ReportPrompts:
    
    SERVER_SYSTEM_PROMPT = """你是由 Google Deepmind 開發的精準執法 AI 分析師。你的任務是協助警方交通執法單位分析數據，並生成專業、客觀且具建設性的執法成效報告。

請遵循以下原則：
1. **數據導向**：所有論點必須基於提供的 JSON 數據，嚴禁編造數據。
2. **專業語氣**：使用臺灣警政與交通專業術語（如：A1/A2事故、逕行舉發、攔停舉發）。
3. **解決方案**：不僅指出問題，更要根據「3E政策」（工程 Engineering、執法 Enforcement、教育 Education）提出具體建議。
4. **理論基礎**：分析時應隱含運用犯罪學與交通安全理論（如威嚇理論、哈頓矩陣）。

報告受眾為高階警官與決策者，請確保內容精簡有力，邏輯清晰。"""

    @staticmethod
    def get_analysis_prompt(data: ReportSummary) -> str:
        """
        生成綜合分析報告的 Prompt
        """
        data_json = data.model_dump_json(indent=2)
        
        return f"""
請根據以下 JSON 格式的統計數據，撰寫一份「交通執法成效與事故防制分析報告」。

### 數據來源：
{data_json}

### 報告結構要求：

1.  **成效摘要 (Summary)**
    *   簡述本月 A1/A2 事故與總體違規的變化趨勢（與去年同期比較）。
    *   以一句話總結本月執法成效（例：「執法力度增強，事故顯著下降」或「違規取締減少，但事故仍呈上升，需檢討策略」）。

2.  **事故與執法關聯分析 (M1 威嚇理論視角)**
    *   分析違規取締數量變化與事故發生率之間的關聯。
    *   是否存在「執法紅利」？（即取締增加導致事故減少）。
    *   若取締增加但事故未減，嘗試分析可能原因（如：取締項目未對症下藥、執法地點與事故熱點未重疊）。

3.  **熱點與時空分析 (M2 熱點理論視角)**
    *   **事故熱點**：指出前 3 大事故熱點及其特性。
    *   **違規熱點**：指出前 3 大違規熱點。
    *   **重疊分析**：執法熱點是否涵蓋了事故熱點？是否存在「執法與事故空間錯置」的問題？
    *   **轉移效應**：是否有觀察到事故熱點轉移的跡象？（基於數據推論或建議持續觀察）。

4.  **改進建議 (M3/M4 綜合視角)**
    *   針對本月數據，提出下個月的重點執法建議。
    *   **執法策略 (Enforcement)**：建議加強取締的項目（如酒駕、闖紅燈）或時段/地點。
    *   **工程與教育 (Engineering & Education)**：若單靠執法難以改善（如特定路口反覆發生事故），提出可能的工程改善方向或宣導重點。

請以 Markdown 格式輸出，直接生成報告內容，無需前言後語。
"""
